[{"id":"91987502.c44518","type":"tab","label":"[UI] Pantalla Principal","disabled":false,"info":""},{"id":"e6863b17.8f4f98","type":"tab","label":"[UI] Ajustes","disabled":false,"info":""},{"id":"9cfa07f0.e9ab28","type":"tab","label":"To Serial ESP","disabled":false,"info":""},{"id":"e073d595.09a098","type":"tab","label":"Apagar Rasp","disabled":false,"info":""},{"id":"c7de3eda.30f35","type":"tab","label":"Contador Automatico","disabled":false,"info":""},{"id":"f93dd7ce.20ff88","type":"serial-port","z":"","serialport":"/dev/ttyAMA0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true,"responsetimeout":"10000"},{"id":"146169d5.fe0886","type":"serial-port","z":"","serialport":"/dev/ttyS0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false,"responsetimeout":"10000"},{"id":"31aa3dd.89bc2c2","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","newline":"\\n","bin":"false","out":"char","addchar":"true","responsetimeout":"10000"},{"id":"afa8a771.f724d8","type":"serial-port","z":"","serialport":"/dev/ttyAMA0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true,"responsetimeout":"10000"},{"id":"9d847c62.ced8f","type":"serial-port","z":"","serialport":"/dev/ttyS0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false,"responsetimeout":"10000"},{"id":"b9d2707a.79eb7","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","waitfor":"","newline":"\\n","bin":"false","out":"char","addchar":"false","responsetimeout":"1000"},{"id":"2a5ea82f.6e1f48","type":"ui_base","z":0,"theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"3acfa5f5.2a128a","type":"ui_tab","z":"","name":"Registro Mensual","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"792fc4c5.22850c","type":"ui_group","z":"","name":"Fechador Accidentes","tab":"3acfa5f5.2a128a","disp":true,"width":"15","collapse":false},{"id":"31abe080.0e165","type":"mqtt-broker","z":"","name":"","broker":"web.inventoteca.com","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"514b0d2f.3730f4","type":"ui_spacer","name":"spacer","group":"1aecb296.35168d","order":1,"width":1,"height":1},{"id":"303ebc11.87ad44","type":"ui_group","z":"","name":"Conteo desde el último accidente","tab":"3acfa5f5.2a128a","disp":true,"width":15,"collapse":false},{"id":"b937733c.4dfb6","type":"ui_group","z":"","name":"Sistema","tab":"3acfa5f5.2a128a","disp":true,"width":"15","collapse":true},{"id":"248abb6c.a54a74","type":"ui_tab","z":"","name":"Pantalla Principal","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"b4664949.3452b8","type":"ui_group","z":"","name":"Registro Diario","tab":"248abb6c.a54a74","disp":true,"width":15,"collapse":false},{"id":"bd736dcd.729a7","type":"ui_group","z":"","name":"Conteos desde el último accidente","tab":"248abb6c.a54a74","disp":true,"width":15,"collapse":false},{"id":"123fe0f3.faef6f","type":"ui_group","z":"","name":"Registro Diario","tab":"5bd158b9.1956d8","disp":true,"width":15,"collapse":false},{"id":"5bd158b9.1956d8","type":"ui_tab","z":"","name":"Pantalla Principal","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"1095345e.93b9bc","type":"ui_group","z":"","name":"Fechador Accidentes","tab":"12d7d971.fac037","disp":true,"width":"15","collapse":false},{"id":"ecdaf936.428408","type":"mqtt-broker","z":"","name":"","broker":"web.inventoteca.com","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"468bb976.418848","type":"ui_group","z":"","name":"Sistema","tab":"12d7d971.fac037","disp":true,"width":"15","collapse":true},{"id":"12d7d971.fac037","type":"ui_tab","z":"","name":"Ajustes","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"11194f05.2a6bb9","type":"function","z":"9cfa07f0.e9ab28","name":"Formato Serial Mes","func":"var convertidor;\n//var Moment =  context.global.get('moment');\nvar valColor = global.get('valColor')||0;\nvar valMes = global.get('valMes')||0;\n//var fecha = new Moment();\n//global.set('fecha',fecha.format('DD/MM/YYYY, HH:mm:ss'));\n//var msg2 = {payload: fecha.format('DD/MM/YYYY, HH:mm:ss')};\nvar msg3 = {payload: valColor}\n\nconvertidor ='m' +  valMes + ',' + valColor + ')';\nmsg = {payload: convertidor};\n\nreturn [msg,msg3];","outputs":1,"noerr":0,"x":214,"y":172,"wires":[["b30c5dec.309b4"]]},{"id":"f9497700.1ebd2","type":"function","z":"9cfa07f0.e9ab28","name":"Formato Serial Fecha","func":"var convertidor;\n//var Moment =  context.global.get('moment');\nvar valColor = global.get('valColor')||0;\nvar dia = global.get('dia')||0;\n//var fecha = new Moment();\n//global.set('fecha',fecha.format('DD/MM/YYYY, HH:mm:ss'));\n//var msg2 = {payload: fecha.format('DD/MM/YYYY, HH:mm:ss')};\nvar msg3 = {payload: valColor}\n\nconvertidor ='f' +  dia + ',' + valColor + ')';\nmsg = {payload: convertidor};\n\nreturn [msg,msg3];","outputs":1,"noerr":0,"x":224,"y":232,"wires":[["b30c5dec.309b4"]]},{"id":"b30c5dec.309b4","type":"rbe","z":"9cfa07f0.e9ab28","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":494,"y":232,"wires":[["ff4f4d9.3071cb"]]},{"id":"ff4f4d9.3071cb","type":"delay","z":"9cfa07f0.e9ab28","name":"","pauseType":"rate","timeout":"100","timeoutUnits":"milliseconds","rate":"2","nbRateUnits":"0.5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":634,"y":232,"wires":[["71364868.31ecc","ac6f9802.438328"]]},{"id":"71364868.31ecc","type":"serial out","z":"9cfa07f0.e9ab28","name":"Arduino","serial":"b9d2707a.79eb7","x":804,"y":232,"wires":[]},{"id":"ac6f9802.438328","type":"debug","z":"9cfa07f0.e9ab28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":854,"y":292,"wires":[]},{"id":"47451980.4c8cc","type":"function","z":"9cfa07f0.e9ab28","name":"Formato Serial Apagado","func":"var convertidor;\n//var Moment =  context.global.get('moment');\n//var valColor = flow.get('valColor')||0;\nvar s = global.get('s')||0;\n//var fecha = new Moment();\n//global.set('fecha',fecha.format('DD/MM/YYYY, HH:mm:ss'));\n//var msg2 = {payload: fecha.format('DD/MM/YYYY, HH:mm:ss')};\n//var msg3 = {payload: valColor}\n\nconvertidor ='s';\nmsg = {payload: convertidor};\n\nreturn [msg];","outputs":1,"noerr":0,"x":234,"y":352,"wires":[["b30c5dec.309b4"]]},{"id":"a514d494.b264d8","type":"function","z":"9cfa07f0.e9ab28","name":"Formato Serial Año","func":"var convertidor;\n//var Moment =  context.global.get('moment');\nvar valColor = global.get('valColor')||0;\nvar valAnio = global.get('valAnio')||0;\n//var fecha = new Moment();\n//global.set('fecha',fecha.format('DD/MM/YYYY, HH:mm:ss'));\n//var msg2 = {payload: fecha.format('DD/MM/YYYY, HH:mm:ss')};\nvar msg3 = {payload: valColor}\n\nconvertidor ='a' +  valAnio + ',' + valColor + ')';\nmsg = {payload: convertidor};\n\nreturn [msg,msg3];","outputs":1,"noerr":0,"x":214,"y":112,"wires":[["b30c5dec.309b4"]]},{"id":"22dfd485.daf32c","type":"function","z":"9cfa07f0.e9ab28","name":"Formato Serial Días Totales","func":"var convertidor;\n//var Moment =  context.global.get('moment');\n//var valColor = flow.get('valColor')||0;\nvar valDiaActual = global.get('valDiaActual')||0;\n//var fecha = new Moment();\n//global.set('fecha',fecha.format('DD/MM/YYYY, HH:mm:ss'));\n//var msg2 = {payload: fecha.format('DD/MM/YYYY, HH:mm:ss')};\n//var msg3 = {payload: valColor}\n\nconvertidor ='t' +  valDiaActual + ',' + 0 + ')'; //0 Color Blanco\nmsg = {payload: convertidor};\n\nreturn [msg];","outputs":1,"noerr":0,"x":244,"y":292,"wires":[["b30c5dec.309b4"]]},{"id":"b3296459.3f4dd","type":"link in","z":"9cfa07f0.e9ab28","name":"thisIsSerialAño","links":["9624855f.1b31d8","5ed9a6a6.2e6d88","c98ed79a.efb948"],"x":79,"y":112,"wires":[["a514d494.b264d8"]]},{"id":"5535c068.dd855","type":"link in","z":"9cfa07f0.e9ab28","name":"thisIsSerialMes","links":["e3b708b0.722f38","2c6599a5.fbc966","41aa6456.8b2cec"],"x":79,"y":172,"wires":[["11194f05.2a6bb9"]]},{"id":"933f37ea.a772c","type":"link in","z":"9cfa07f0.e9ab28","name":"thisIsSerialFecha","links":["1473c291.672e3d","2e342fe9.1fb96","ff9d9c7.75d2e6"],"x":79,"y":232,"wires":[["f9497700.1ebd2"]]},{"id":"2a896679.3eec12","type":"link in","z":"9cfa07f0.e9ab28","name":"thisIsSerialDíasTotal","links":["723a983d.8d506","f2bc1a68.31fd9","457815a4.fe49ec"],"x":79,"y":292,"wires":[["22dfd485.daf32c"]]},{"id":"13f68980.3a5f37","type":"link in","z":"9cfa07f0.e9ab28","name":"thisIsSerialApagadoNPX","links":["591b4100.972f7","48602eb1.8d76e","6d84e891.cca248"],"x":79,"y":352,"wires":[["47451980.4c8cc"]]},{"id":"41d4d9a2.cde868","type":"exec","z":"e073d595.09a098","command":"sudo halt ","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":640,"y":180,"wires":[[],[],[]]},{"id":"9e2d4100.de4f9","type":"inject","z":"e073d595.09a098","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":450,"y":180,"wires":[["41d4d9a2.cde868"]]},{"id":"99d80193.5a9e7","type":"serial in","z":"e073d595.09a098","name":"","serial":"b9d2707a.79eb7","x":420,"y":300,"wires":[["deca3383.4a09d"]]},{"id":"deca3383.4a09d","type":"debug","z":"e073d595.09a098","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":300,"wires":[]},{"id":"3cba0e4f.ded342","type":"inject","z":"e073d595.09a098","name":"","topic":"","payload":"a19,0)","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":400,"wires":[["7e80d141.9c065"]]},{"id":"7e80d141.9c065","type":"serial out","z":"e073d595.09a098","name":"","serial":"31aa3dd.89bc2c2","x":660,"y":400,"wires":[]},{"id":"17ac1ebd.6d5801","type":"function","z":"91987502.c44518","name":"global Set Color Fecha","func":"//var valColor = global.get('valColor')||0;\nvar valColor = msg.payload\nglobal.set('valColor',valColor);\n\nmsg = {payload: valColor};\n\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":400,"wires":[[]]},{"id":"49f43a0b.c8c024","type":"ui_button","z":"91987502.c44518","name":"Registro","group":"123fe0f3.faef6f","order":3,"width":0,"height":0,"passthru":false,"label":"Registrar Incidente del día actual","tooltip":"","color":"","bgcolor":"dark green","icon":"","payload":"valColor,dia","payloadType":"str","topic":"","x":120,"y":480,"wires":[[]]},{"id":"168eb692.96eb79","type":"ui_dropdown","z":"91987502.c44518","name":"","label":"Tipo de Incidente","tooltip":"","place":"Incidente","group":"123fe0f3.faef6f","order":2,"width":0,"height":0,"passthru":true,"options":[{"label":"Sin Accidentes","value":"0","type":"str"},{"label":"Casi Accidente","value":"1","type":"str"},{"label":"Primer Auxilio","value":"2","type":"str"},{"label":"No Incapacitante","value":"3","type":"str"},{"label":"Incapacitante","value":"4","type":"str"}],"payload":"","topic":"","x":150,"y":400,"wires":[["17ac1ebd.6d5801"]]},{"id":"78851a50.86edb4","type":"comment","z":"91987502.c44518","name":"Aquí sólo modificarás la fecha actual.","info":"","x":210,"y":240,"wires":[]},{"id":"a506cd96.75a5d","type":"ui_text","z":"91987502.c44518","group":"123fe0f3.faef6f","order":1,"width":0,"height":0,"name":"","label":"Fecha Actual:","format":"{{msg.payload}}","layout":"col-center","x":560,"y":300,"wires":[]},{"id":"2c4b83e4.642a1c","type":"inject","z":"91987502.c44518","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":300,"wires":[["98766022.de5f9"]]},{"id":"98766022.de5f9","type":"function","z":"91987502.c44518","name":"fecha-actual","func":"var Moment =  context.global.get('moment')\nvar actual =  new Moment()\n\nmsg.payload = actual.format('DD/MM/YY, HH:mm')\nglobal.set('fecha',msg.payload)\n\nreturn msg","outputs":1,"noerr":0,"x":340,"y":300,"wires":[["a506cd96.75a5d"]]},{"id":"1839f27b.43545e","type":"ui_text","z":"91987502.c44518","group":"123fe0f3.faef6f","order":3,"width":0,"height":0,"name":"","label":"Días sin accidentes","format":"{{msg.payload}}","layout":"row-spread","x":450,"y":580,"wires":[]},{"id":"fb3d6923.fb6248","type":"link in","z":"91987502.c44518","name":"pantalla_principal","links":["11aa12b1.0ca07d"],"x":235,"y":580,"wires":[["1839f27b.43545e"]]},{"id":"125cfc8c.ef1043","type":"function","z":"e6863b17.8f4f98","name":"global Set Color Fecha","func":"var valColor = global.get('valColor')||0;\nvalColor = msg.payload.replace(/[rgb()\\s]/g,\"\");\nglobal.set('valColor',valColor);\n\nmsg = {payload: valColor};\n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":360,"wires":[["8d29a883.dda378","526c1e31.d6b58"]]},{"id":"c3a66f86.96ee","type":"function","z":"e6863b17.8f4f98","name":"global Set Fecha","func":"\nvar contador = msg.payload;\nglobal.set('dia',contador);\n//global.set(\"index\",i);\nmsg.payload = contador;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":300,"wires":[["8d29a883.dda378","526c1e31.d6b58"]]},{"id":"7fab7b5d.2355b4","type":"function","z":"e6863b17.8f4f98","name":"global reset dias totales","func":"var accidente = global.get('valColor')||0;\nvar valDiaActual;\nvar contadorDias;\n\ncontadorDias = msg.payload;\nif (accidente>=2)\n{\n    contadorDias = 0;\n    global.set('valDiaActual',contadorDias);\n}\nmsg.payload = contadorDias;\nreturn msg;\n","outputs":1,"noerr":0,"x":1330,"y":460,"wires":[["51fac5aa.6e34ec"]]},{"id":"4e469fe5.4963a","type":"function","z":"e6863b17.8f4f98","name":"global reset años","func":"var accidente = global.get('valColor')||0;\nvar valAnio;\nvar contadorAnio;\ncontadorAnio = msg.payload;\nif (accidente>=2)\n{\n    contadorAnio = 0;\n    global.set('valAnio',contadorAnio);\n}\nmsg.payload = contadorAnio;\nreturn msg;\n","outputs":1,"noerr":0,"x":1310,"y":380,"wires":[["1d1e08d3.7321d7"]]},{"id":"944bed4b.b7d63","type":"function","z":"e6863b17.8f4f98","name":"global reset meses","func":"var accidente = global.get('valColor')||0;\nvar valMes;\nvar contadorMes;\ncontadorMes = msg.payload;\nif (accidente>=2)\n{\n    contadorMes = 0;\n    global.set('valMes',contadorMes);\n}\nmsg.payload = contadorMes;\nreturn msg;\n","outputs":1,"noerr":0,"x":1310,"y":420,"wires":[["25ace8aa.de0db8"]]},{"id":"58d74506.5bddcc","type":"delay","z":"e6863b17.8f4f98","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1110,"y":420,"wires":[["7fab7b5d.2355b4","944bed4b.b7d63","4e469fe5.4963a"]]},{"id":"8d29a883.dda378","type":"ui_button","z":"e6863b17.8f4f98","name":"","group":"1095345e.93b9bc","order":3,"width":0,"height":0,"passthru":false,"label":"Registrar Incidente","tooltip":"","color":"","bgcolor":"","icon":"","payload":"valColor,dia","payloadType":"str","topic":"","x":1130,"y":300,"wires":[["58d74506.5bddcc","2157c811.450208"]]},{"id":"a44d58e3.c37218","type":"ui_date_picker","z":"e6863b17.8f4f98","name":"","label":"Fecha","group":"1095345e.93b9bc","order":1,"width":0,"height":0,"passthru":true,"topic":"","x":590,"y":300,"wires":[[]]},{"id":"2157c811.450208","type":"link out","z":"e6863b17.8f4f98","name":"toSerialFecha","links":["a80607a6.3df5c8","ac7dc653.14cf18"],"x":1355,"y":320,"wires":[]},{"id":"51fac5aa.6e34ec","type":"link out","z":"e6863b17.8f4f98","name":"toSerialDíasTotal","links":["77b519bd.fe819","a2344f8a.33137"],"x":1495,"y":460,"wires":[]},{"id":"25ace8aa.de0db8","type":"link out","z":"e6863b17.8f4f98","name":"toSerialMes","links":["575ef3c9.d935b4","caa3197d.592c58"],"x":1495,"y":420,"wires":[]},{"id":"1d1e08d3.7321d7","type":"link out","z":"e6863b17.8f4f98","name":"toSerialAño","links":["632e3340.c7777c","4fbe3be4.a81664"],"x":1495,"y":380,"wires":[]},{"id":"22b53634.ecdeea","type":"mqtt in","z":"e6863b17.8f4f98","name":"","topic":"cruzdeseguridad/diastotal/num","qos":"2","broker":"ecdaf936.428408","x":190,"y":120,"wires":[["462eb6e0.0ce788"]]},{"id":"45bedcf4.e63cb4","type":"mqtt in","z":"e6863b17.8f4f98","name":"","topic":"cruzdeseguridad/fecha/col","qos":"2","broker":"ecdaf936.428408","x":170,"y":460,"wires":[["2157c811.450208"]]},{"id":"7862a03f.5a903","type":"comment","z":"e6863b17.8f4f98","name":"Desde MQTT sólo modificarás la fecha actual.","info":"","x":230,"y":300,"wires":[]},{"id":"2bb0bc2d.ae0b64","type":"ui_button","z":"e6863b17.8f4f98","name":"","group":"468bb976.418848","order":1,"width":0,"height":0,"passthru":false,"label":"Apagar Displays","tooltip":"","color":"","bgcolor":"black","icon":"","payload":"s","payloadType":"str","topic":"","x":640,"y":560,"wires":[["e86c3977.93acc8"]]},{"id":"e86c3977.93acc8","type":"link out","z":"e6863b17.8f4f98","name":"toSerialApagadoNPX","links":["1efcbf91.dec6d8","bf9c3763.ebd728"],"x":775,"y":560,"wires":[]},{"id":"a29492c2.ee58","type":"comment","z":"e6863b17.8f4f98","name":"Sección dedicada al fechador de accidentes.","info":"","x":230,"y":260,"wires":[]},{"id":"526c1e31.d6b58","type":"debug","z":"e6863b17.8f4f98","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1100,"y":220,"wires":[]},{"id":"7beb3716.ab9bd8","type":"link out","z":"e6863b17.8f4f98","name":"toSerialDíasTotal","links":["77b519bd.fe819","a2344f8a.33137"],"x":735,"y":120,"wires":[]},{"id":"462eb6e0.0ce788","type":"function","z":"e6863b17.8f4f98","name":"dias-desde","func":"var Moment =  context.global.get('moment')\nvar d  = global.get('fecha')||0\nvar cuenta = flow.get('numero')||0\n\n\nvar actual =  new Moment()\nvar ultima =  new Moment(d,'DD/MM/YYYY, HH:mm:ss')\n\nvar days = actual.diff(ultima, 'days')\n//flow.set('numero',117);\n\nglobal.set('dias',days)\n\n\nmsg.payload = cuenta\nreturn msg\n\n\n\n","outputs":1,"noerr":0,"x":510,"y":120,"wires":[[]]},{"id":"df1f8fc5.d5026","type":"function","z":"c7de3eda.30f35","name":"dias-desde","func":"// Se agrega la librería de 'moment' a la funcion\nvar Moment =  context.global.get('moment')\n\n// Se crea la variable 'd' para bajar la 'fecha' \n// que es la fecha de la ultima actualización\nvar d  = global.get('fecha')||0\n\n// Se crea la variable cuenta, que baja el 'numero'\n// que es la cantidad de días sin accidentes\nvar cuenta = flow.get('numero')||0\n\n// 'actual' almacena la fecha del momento de la consulta\nvar actual =  new Moment()\n\n// 'ultima' sirve para darle formato a la comparación\nvar ultima =  new Moment(d,'DD/MM/YYYY, HH:mm:ss')\n\n// 'dias' almacena la diferencia de días desde\n// la ultima actualización\nvar dias = actual.diff(ultima, 'days')\n\n// Se suman los días almacenados en cuenta con los \n// días calculados por la consulta\ndias = dias + cuenta\nglobal.set('numero',dias)\n\n\nmsg.payload = dias\nreturn msg\n\n\n\n","outputs":1,"noerr":0,"x":410,"y":80,"wires":[["48fac75.4c0ca38","6cb71713.94bef8"]]},{"id":"e1b872f1.30561","type":"inject","z":"c7de3eda.30f35","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":80,"wires":[["df1f8fc5.d5026"]]},{"id":"48fac75.4c0ca38","type":"debug","z":"c7de3eda.30f35","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":660,"y":80,"wires":[]},{"id":"6cb71713.94bef8","type":"link out","z":"c7de3eda.30f35","name":"contador","links":["40b7c5e4.aba71c"],"x":615,"y":140,"wires":[]}]